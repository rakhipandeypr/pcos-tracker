{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Reports - Period & PCOD Tracker</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --primary:#ff6fa8;
  --primary-dark:#e65c95;
  --secondary:#b8a7ff;
  --background:#faf8fc;
  --card-bg:#ffffff;
  --text:#2a2a2a;
  --radius:18px;
  --shadow:0 8px 20px rgba(0,0,0,0.06);
}
*{box-sizing:border-box;}
body{font-family:'Poppins',sans-serif;margin:0;background:var(--background);color:var(--text);}

/* HEADER */
header{background:linear-gradient(90deg,var(--primary),var(--secondary));color:white;padding:20px 40px;display:flex;justify-content:space-between;align-items:center;font-size:1.8rem;font-weight:700;border-bottom-left-radius:20px;border-bottom-right-radius:20px;box-shadow:var(--shadow);}
.logout-btn{color:white;text-decoration:none;font-size:.9rem;border:1px solid rgba(255,255,255,.7);padding:8px 18px;border-radius:25px;}
.logout-btn:hover{background:white;color:var(--primary);}

/* NAV */
nav{display:flex;justify-content:center;gap:12px;padding:15px;background:#fff;margin:20px auto;border-radius:15px;width:90%;max-width:1100px;box-shadow:var(--shadow);flex-wrap:wrap;}
nav a{text-decoration:none;color:var(--primary);font-weight:600;padding:10px 18px;border-radius:22px;}
nav a.active,nav a:hover{background:var(--primary);color:white;}

/* CONTAINER */
.container{max-width:1200px;margin:auto;padding:30px 20px;}
h2{text-align:center;color:var(--primary);margin-bottom:30px;}

/* METRICS */
.metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:25px;margin-bottom:40px;}
.metric-card{background:var(--card-bg);padding:30px;border-radius:var(--radius);box-shadow:var(--shadow);text-align:center;border-top:6px solid var(--primary);}
.metric-card h1{font-size:2.2rem;color:var(--secondary);margin:0;}
.metric-card p{margin-top:8px;font-weight:600;}

/* CHARTS */
.charts{display:grid;grid-template-columns:1fr;gap:25px;margin-bottom:40px;}
.chart-card{background:var(--card-bg);padding:25px;border-radius:var(--radius);box-shadow:var(--shadow);height:320px;}
canvas{width:100%!important;height:100%!important;}

/* TABLE */
.table-card{background:var(--card-bg);padding:25px;border-radius:var(--radius);box-shadow:var(--shadow);overflow-x:auto;}
table{width:100%;border-collapse:collapse;min-width:600px;}
th{background:var(--secondary);color:white;padding:12px;}
td{padding:12px;text-align:center;border-bottom:1px solid #eee;}

/* DOWNLOAD BUTTON */
.download-btn{
  background:linear-gradient(90deg,var(--primary),var(--secondary));
  color:white;padding:10px 18px;border-radius:25px;text-decoration:none;font-weight:600;
  box-shadow:0 4px 12px rgba(255,111,168,.3);
}
.download-btn:hover{opacity:.9;}

@media(min-width:768px){.charts{grid-template-columns:1fr 1fr;}}
</style>
</head>

<body>

<header>
Period & PCOD Tracker
<a href="{% url 'logout' %}" class="logout-btn">Logout</a>
</header>

<nav>
<a href="{% url 'dashboard' %}">Dashboard</a>
<a href="{% url 'add_period' %}">Add Period</a>
<a href="{% url 'history' %}">History</a>
<a href="{% url 'prediction' %}">Prediction</a>
<a href="{% url 'add_symptoms' %}">Symptoms</a>
<a href="{% url 'reports' %}" class="active">Reports</a>
</nav>

<main class="container">

<div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;">
<h2>Health Reports ðŸ“Š</h2>
<a href="{% url 'download_report' %}" class="download-btn">â¬‡ Download PDF</a>
</div>

<div class="metrics">
<div class="metric-card">
<h1>{{ avg_cycle|default:0|floatformat:1 }}</h1>
<p>Average Cycle Length (Days)</p>
</div>
<div class="metric-card">
<h1>{{ avg_duration|default:0|floatformat:1 }}</h1>
<p>Average Period Duration (Days)</p>
</div>
</div>

<div class="charts">
<div class="chart-card">
<h3>Cycle Length Trend</h3>
<canvas id="cycleChart"></canvas>
</div>
<div class="chart-card">
<h3>Symptoms Frequency</h3>
<canvas id="symptomChart"></canvas>
</div>
</div>

<div class="table-card">
<h3>Recent Cycle History</h3>
<table>
<thead><tr><th>Start Date</th><th>Duration</th><th>Cycle Length</th></tr></thead>
<tbody>
{% for log in logs_table %}
<tr>
<td>{{ log.StartDate|date:"d M Y" }}</td>
<td>{{ log.Duration }} Days</td>
<td>{{ log.CycleLength|default:"--" }} Days</td>
</tr>
{% empty %}
<tr><td colspan="3">No data available</td></tr>
{% endfor %}
</tbody>
</table>
</div>

</main>

<script>
const cycleLabels=[{% for log in logs_chart %}"{{ log.StartDate|date:'M d' }}"{% if not forloop.last %},{% endif %}{% endfor %}];
const cycleData=[{% for log in logs_chart %}{{ log.CycleLength|default:28 }}{% if not forloop.last %},{% endif %}{% endfor %}];
const symptomLabels=[{% for s in symptom_counts %}"{{ s.SymptomName }}"{% if not forloop.last %},{% endif %}{% endfor %}];
const symptomData=[{% for s in symptom_counts %}{{ s.total }}{% if not forloop.last %},{% endif %}{% endfor %}];

new Chart(document.getElementById('cycleChart'),{type:'line',data:{labels:cycleLabels,datasets:[{data:cycleData,borderColor:'#ff6fa8',backgroundColor:'rgba(255,111,168,0.15)',fill:true,tension:.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
new Chart(document.getElementById('symptomChart'),{type:'bar',data:{labels:symptomLabels,datasets:[{data:symptomData,backgroundColor:'#b8a7ff',borderRadius:8}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}});
</script>

</body>
</html>
